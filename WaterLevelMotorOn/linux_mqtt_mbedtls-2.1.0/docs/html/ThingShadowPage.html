<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>AWS IoT Embedded C Device SDK: Thing Shadow</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AWS IoT Embedded C Device SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Thing Shadow </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Thing Shadow module implements the JSON based protocol of the AWS IoT Thing Shadow. The SDK currently supports only one Thing Name for a device. Though the device can update any "Thing" using the Thing Name. A Device can perform update, get and delete action on its own or any Thing Shadow. There are totally 3 Key value pair a device needs to concerned about.</p><ul>
<li>reported</li>
<li>desired</li>
<li>delta All these keys are under the "state".</li>
</ul>
<p>The device will always receive a delta message if there is any difference between the desired and the reported section of the device. Unless there is no call made to the <a class="el" href="aws__iot__shadow__interface_8h.html#a2b6000e1a7590cff3b6e66601b0c4934" title="This function is used to listen on the delta topic of #AWS_IOT_MY_THING_NAME mentioned in the aws_iot...">aws_iot_shadow_register_delta()</a>, The SDK will not subscribe to the delta topic.</p>
<h1><a class="anchor" id="response"></a>
Shadow Acknowledgments</h1>
<p>If we want to perform an Update to a thing shadow and get the acknowledgment of the action. One of two things can happen, The update action could be accepted by the Thing Shadow and the version of the JSON document will be updated. The update request could also be rejected.</p>
<p>To know one way or the other, we need to subscribe to the 2 topics: $aws/things/{thingName}/shadow/update/accepted and $aws/things/{thingName}/shadow/update/rejected . One issue with this approach is that, There could be multiple devices trying to update the same shadow. Then it becomes impossible to know if was our update or the other apps. To avoid this we include a client token string to the request. It is of the form: "clientToken": "UniqueClientID+Seq". We use the MQTT client ID #AWS_IOT_MQTT_CLIENT_ID (as it has to be unique for one AWS account) with a sequence number to differentiate between our previous update requests.</p>
<p>This is taken care for you by the APIs in <a class="el" href="aws__iot__shadow__json__data_8h.html" title="This file is the interface for all the Shadow related JSON functions. ">aws_iot_shadow_json_data.h</a> file. In particular the <a class="el" href="aws__iot__shadow__json__data_8h.html#acc1c9fe2e514d9b46d659ad4161d0a54" title="Finalize the JSON document with Shadow expected client Token. ">aws_iot_finalize_json_document()</a> adds the client token to the JSON request</p>
<h1><a class="anchor" id="shadowJson"></a>
Shadow JSON construction</h1>
<p>There are APIs to help you in constructing a JSON update request in the <a class="el" href="aws__iot__shadow__json__data_8h.html" title="This file is the interface for all the Shadow related JSON functions. ">aws_iot_shadow_json_data.h</a> file. More about the usage could be found in the <a class="el" href="shadow__sample_8c.html" title="A simple connected window example demonstrating the use of Thing Shadow. ">shadow_sample.c</a> file. The update request construction should happen in this order.</p><ol type="1">
<li><a class="el" href="aws__iot__shadow__json__data_8h.html#aaf7b4fdf63d89d0d94c908773b4d672f" title="Initialize the JSON document with Shadow expected name/value. ">aws_iot_shadow_init_json_document()</a></li>
<li><a class="el" href="aws__iot__shadow__json__data_8h.html#a9750d185786fce0d842cf7615905a122" title="Add the reported section of the JSON document of jsonStruct_t. ">aws_iot_shadow_add_reported()</a> <dl class="section note"><dt>Note</dt><dd>desired and reported section are not mandatory. Most devices might just use the reported section</dd></dl>
</li>
<li><a class="el" href="aws__iot__shadow__json__data_8h.html#ad4e3bbcfa3d4493d5885af8a26c59acc" title="Add the desired section of the JSON document of jsonStruct_t. ">aws_iot_shadow_add_desired()</a></li>
<li><a class="el" href="aws__iot__shadow__json__data_8h.html#acc1c9fe2e514d9b46d659ad4161d0a54" title="Finalize the JSON document with Shadow expected client Token. ">aws_iot_finalize_json_document()</a> <dl class="section note"><dt>Note</dt><dd>These APIs are there for the convenience and needs to be used with care. In the future revisions ideally this will be replaced with Auto code generation capabilities as most of the devices dont need dynamic configuration of the JSON document. </dd></dl>
</li>
</ol>
<h2><a class="anchor" id="jsonlib"></a>
JSON Library</h2>
<p>The JSON library used for this SDK is <a href="http://zserge.com/jsmn.html">JSMN </a> . This library is not using any dynamic memory allocation.</p>
<h1><a class="anchor" id="configShadow"></a>
Configuration</h1>
<p>#SHADOW_MAX_SIZE_OF_RX_BUFFER</p>
<p>#MAX_SIZE_OF_UNIQUE_CLIENT_ID_BYTES</p>
<p>#MAX_SIZE_CLIENT_ID_WITH_SEQUENCE</p>
<p>#MAX_SIZE_CLIENT_TOKEN_CLIENT_SEQUENCE</p>
<p>#MAX_ACKS_TO_COMEIN_AT_ANY_GIVEN_TIME</p>
<p>#MAX_THINGNAME_HANDLED_AT_ANY_GIVEN_TIME</p>
<p>#MAX_JSON_TOKEN_EXPECTED</p>
<p>#MAX_SHADOW_TOPIC_LENGTH_WITHOUT_THINGNAME</p>
<p>#MAX_SIZE_OF_THING_NAME</p>
<p>#MAX_SHADOW_TOPIC_LENGTH_BYTES</p>
<h1><a class="anchor" id="bugsShadow"></a>
Known Issues</h1>
<ul>
<li>No nested JSON can be parsed by the <code><a class="el" href="aws__iot__shadow__json__data_8h.html#a429dd7999755780be803c160a8f72549" title="This is a static JSON object that could be used in code. ">jsonStruct_t</a></code> </li>
<li>The device can assume only one thing name </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
